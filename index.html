<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Telefon Ustaxona ‚Äî WebApp (Liquid Glass, Pro)</title>
  <meta name="theme-color" content="#0f172a">
  <style>
    /* ‚Äî‚Äî‚Äî‚Äî‚Äî Reset & base ‚Äî‚Äî‚Äî‚Äî‚Äî */
    *, *::before, *::after { box-sizing: border-box; }
    html, body { height: 100%; }
    body { margin: 0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji"; }

    /* ‚Äî‚Äî‚Äî‚Äî‚Äî Theme (improved day/night contrast) ‚Äî‚Äî‚Äî‚Äî‚Äî */
    :root{
      /* Night mode ‚Äì deep, elegant, OLED-friendly */
      --bg: #05070d;
      --text: #e9eef7;
      --muted: #9ba8b9;
      --primary: #3b82f6;
      --accent: #14b8a6;
      --accent-2: #2dd4bf;
      --warning: #f59e0b;
      --danger: #f43f5e;
      --glass: rgba(10,15,24,0.82);
      --glass-2: rgba(10,15,24,0.6);
      --ring: rgba(59,130,246,0.35);
      --border: rgba(148,163,184,0.14);
      --chip: rgba(148,163,184,0.16);
      --chip-text: #e9eef7;
    }
/* ‚Äî‚Äî‚Äî‚Äî‚Äî Theme (serious / pro palette, dark & light) ‚Äî‚Äî‚Äî‚Äî‚Äî */

    /* DARK (default) */
    :root{
    --bg: #0c1220;            /* deep navy */
    --text: #e6edf3;          /* soft white */
    --muted: #9aa8ba;         /* slate */
    --primary: #1f6feb;       /* pro blue */
    --accent: #2dd4bf;        /* teal */
    --accent-2: #14b8a6;      /* stronger teal */
    --warning: #f59e0b;       /* amber for notices */
    --danger: #f43f5e;        /* rose */
    --glass: rgba(20,26,38,0.78);
    --glass-2: rgba(18,24,38,0.62);
    --ring: rgba(31,111,235,0.35);
    --border: rgba(148,163,184,0.16);
    --chip: rgba(148,163,184,0.15);
    --chip-text: #dbe2ea;
    }

    /* LIGHT (day mode) */
    .light{
    --bg: #f5f7fb;            /* bright soft white */
    --text: #0f172a;
    --muted: #475569;
    --primary: #2563eb;
    --accent: #0ea5a3;
    --accent-2: #14b8a6;
    --warning: #b45309;
    --danger: #b91c1c;
    --glass: rgba(255,255,255,0.78);
    --glass-2: rgba(255,255,255,0.6);
    --ring: rgba(37,99,235,0.2);
    --border: rgba(15,23,42,0.12);
    --chip: #e2e8f0;
    --chip-text: #1e293b;
    }

    .light{
      /* Light professional */
      --bg: #f5f7fb;
      --text: #0f172a;
      --muted: #475569;
      --primary: #2563eb;
      --accent: #0ea5a3;
      --accent-2: #14b8a6;
      --warning: #b45309;
      --danger: #b91c1c;
      --glass: rgba(255,255,255,0.78);
      --glass-2: rgba(255,255,255,0.6);
      --ring: rgba(37,99,235,0.2);
      --border: rgba(15,23,42,0.12);
      --chip: #e2e8f0;
      --chip-text: #1e293b;
    }

    /* ‚Äî‚Äî‚Äî‚Äî‚Äî Liquid glass background (serious) ‚Äî‚Äî‚Äî‚Äî‚Äî */
/* --- Background wrapper (night default) --- */
    .bg-wrap{
    position: fixed; inset:0; overflow:hidden; z-index:-1;
    background:
        radial-gradient(60rem 60rem at 120% -10%, rgba(31,111,235,0.14), transparent 60%),
        radial-gradient(40rem 40rem at -20% 10%, rgba(20,184,166,0.12), transparent 60%),
        linear-gradient(180deg, #05070d, #0c1220 40%, #05070d 100%);
    transition: background 0.6s ease, opacity 0.6s ease;
    }

    /* --- DAY MODE background with fade --- */
    .light .bg-wrap{
    background:
        radial-gradient(55rem 55rem at 110% -8%, rgba(59,130,246,0.22), transparent 60%),
        radial-gradient(42rem 42rem at -18% 12%, rgba(20,184,166,0.20), transparent 60%),
        linear-gradient(180deg, #f8fafc, #e8edf6 50%, #f8fafc 100%);
    transition: background 0.6s ease, opacity 0.6s ease;
    }

    .blob{ position:absolute; filter: blur(28px) saturate(130%); opacity:.5; mix-blend: screen; }
    .blob.b1{ width: 38rem; height: 38rem; left:-12rem; top:-10rem; background: radial-gradient(circle at 30% 30%, rgba(31,111,235,0.32), transparent 60%); }
    .blob.b2{ width: 34rem; height: 34rem; right:-10rem; top:-6rem; background: radial-gradient(circle at 70% 30%, rgba(20,184,166,0.30), transparent 60%); }
    .blob.b3{ width: 44rem; height: 44rem; left:50%; bottom:-16rem; transform:translateX(-50%); background: radial-gradient(circle at 50% 50%, rgba(14,165,233,0.18), transparent 60%); }

    /* ‚Äî‚Äî‚Äî‚Äî‚Äî Layout ‚Äî‚Äî‚Äî‚Äî‚Äî */
    .container{ max-width: 460px; margin: 0 auto; padding: 14px; padding-bottom: 112px; min-height: 100dvh; }
    .topbar{ position: sticky; top: 0; backdrop-filter: blur(18px); -webkit-backdrop-filter: blur(18px); background: color-mix(in srgb, var(--glass) 92%, transparent); border-bottom: 1px solid var(--border); z-index: 20; }
    .topbar-inner{ max-width: 460px; margin: 0 auto; display:flex; align-items:center; justify-content:space-between; gap:10px; padding: 10px 12px; color: var(--text); }

    /* ‚Äî‚Äî‚Äî‚Äî‚Äî Glass cards ‚Äî‚Äî‚Äî‚Äî‚Äî */
    .glass{ background: linear-gradient(180deg, var(--glass), var(--glass-2)); border: 1px solid var(--border); box-shadow: 0 10px 30px rgba(2,6,23,0.28); border-radius: 18px; padding: 14px; backdrop-filter: blur(16px) saturate(140%); -webkit-backdrop-filter: blur(16px) saturate(140%); }
    .glass + .glass{ margin-top: 12px; }

    h1,h2,h3{ color: var(--text); margin: 0 0 6px; }
    p{ color: var(--muted); margin: 0 0 10px; }

    /* ‚Äî‚Äî‚Äî‚Äî‚Äî Controls ‚Äî‚Äî‚Äî‚Äî‚Äî */
    .btn{ display:inline-flex; align-items:center; justify-content:center; gap:8px; border:1px solid var(--border); background:#fff0; color: var(--text); padding: 10px 14px; border-radius: 14px; cursor:pointer; transition: transform .06s ease, background .2s ease, border-color .2s ease; text-decoration:none; }
    .btn:active{ transform: translateY(1px) }
    .btn.primary{ background: linear-gradient(135deg, var(--primary), var(--accent)); color: white; border-color: transparent; }
    .btn.ghost{ background: transparent; }
    .btn.block{ width: 100%; }

.input,
.select,
textarea{
  width: 100%;
  padding: 12px 14px;
  border-radius: 12px;
  font-size: 14px;
  border: 1px solid var(--border);

  /* Blurni olib tashlaymiz ‚Äî chunki iOS/Safari/Telegram WebView dropdownni o‚Äòchirmaydi */
  background: rgba(255,255,255,0.92);
  -webkit-backdrop-filter: none !important;
  backdrop-filter: none !important;

  color: var(--text);
  outline: none;
  appearance: none;
  -webkit-appearance: none;
  pointer-events: auto !important;
  position: relative;
  z-index: 9999; /* dropdown ustida chiqadi */
}

/* DARK MODE uchun background o‚Äòzgartiramiz */
:root .input,
:root .select,
:root textarea {
  background: rgba(15,23,42,0.85);
  color: var(--text);
}

/* LIGHT MODE uchun */
.light .input,
.light .select,
.light textarea {
  background: rgba(255,255,255,0.92);
  color: #0f172a;
}

/* FOCUS effekti */
.input:focus,
.select:focus,
textarea:focus{
  border-color: transparent;
  box-shadow: 0 0 0 6px var(--ring);
}

/* Placeholder rangi */
.input::placeholder,
textarea::placeholder {
  color: var(--muted);
  opacity: .9;
}

/* Row */
.row{
  display: grid;
  grid-template-columns: 1fr;
  gap: 10px;
}

/* Labels */
label{
  font-size: 12px;
  color: var(--muted);
  margin-bottom: 4px;
  display: block;
}

/* Suggestions / Chips */
.chips{ 
  display:flex; 
  flex-wrap: wrap; 
  gap: 8px; 
}
.chip{
  padding: 6px 10px;
  border-radius: 999px;
  background: var(--chip);
  color: var(--chip-text);
  cursor: pointer;
  border: 1px solid var(--border);
  font-size: 12px;
}

/* Grid helpers */
.grid-3{ display:grid; grid-template-columns: repeat(3,1fr); gap: 8px; }
.grid-2{ display:grid; grid-template-columns: repeat(2,1fr); gap: 8px; }

    /* ‚Äî‚Äî‚Äî‚Äî‚Äî Footer nav ‚Äî‚Äî‚Äî‚Äî‚Äî */

.tab{
  opacity:1;
  transform:translateY(0);
  transition: opacity .35s ease, transform .35s ease;
}
.tab.hidden{
  opacity:0;
  transform:translateY(14px);
  pointer-events:none;
}

/* --- Navbar Liquid Glass (iPhone style) --- */
.footer{
  position: fixed;
  left:0; right:0; bottom: 26px;
  z-index: 50;
}
.footer-inner{
  margin: 0 auto;
  max-width: 460px;
  padding: 6px;
}

.nav{
  display:grid;
  grid-template-columns: repeat(4,1fr);
  gap:8px;

  /* Liquid glass */
  background: color-mix(in srgb, var(--glass) 78%, transparent);
  border: 1px solid var(--border);
  border-radius: 32px;              /* iPhone pill */
  padding: 10px 10px;
  box-shadow: 0 20px 48px rgba(0,0,0,0.42);

  backdrop-filter: blur(26px) saturate(180%) brightness(1.15);
  -webkit-backdrop-filter: blur(26px) saturate(180%) brightness(1.15);

  transition: background .45s ease, backdrop-filter .45s ease;
}

/* Large buttons */
.nav button, .nav a{
  padding: 10px 0;
  border-radius: 22px;              /* rounder */
  font-size: 12px;
  display:flex;
  flex-direction:column;
  gap:2px;
  align-items:center;
  color: var(--text);
  transition: background .25s ease, color .2s ease;
}

.nav .active{
  background: linear-gradient(135deg, var(--primary), var(--accent));
  color:#fff;
  border-color:transparent;
  box-shadow:0 0 12px rgba(37,99,235,0.45);
}

/* Light mode pill */
.light .nav{
  background: rgba(255,255,255,0.55);
  box-shadow: 0 20px 48px rgba(0,0,0,0.18);
  backdrop-filter: blur(26px) saturate(180%) brightness(1.35);
}
    /* ‚Äî‚Äî‚Äî‚Äî‚Äî Helpers ‚Äî‚Äî‚Äî‚Äî‚Äî */
    .hidden{ display:none !important; }
    .muted{ color: var(--muted); }
    .badge{ background: color-mix(in srgb, var(--glass) 70%, transparent); color: var(--text); border:1px solid var(--border); padding: 6px 10px; border-radius: 999px; font-size: 12px; }
  </style>
</head>
<body>
  <div class="bg-wrap">
    <div class="blob b1"></div>
    <div class="blob b2"></div>
    <div class="blob b3"></div>
  </div>

  <!-- Topbar -->
  <div class="topbar">
    <div class="topbar-inner">
      <div style="display:flex;align-items:center;gap:10px;">
        <div style="padding:8px;border-radius:12px;background:linear-gradient(135deg,var(--primary),var(--accent)); color:#fff;">üõ†Ô∏è</div>
        <div>
          <div style="font-weight:700;line-height:1">Telefon Ustaxona</div>
          <div class="muted" style="font-size:11px;line-height:1">Liquid glass ‚Ä¢ Pro UI ‚Ä¢ AI</div>
        </div>
      </div>
      <div style="display:flex;gap:8px;">
        <a class="btn ghost" href="https://t.me/teleshopuz" target="_blank" rel="noopener">Teleshop</a>
        <button id="themeBtn" class="btn ghost" title="Tun/Tong">üåó</button>
      </div>
    </div>
  </div>

  <!-- Main container -->
  <div class="container">

    <!-- HOME TAB -->
    <section data-tab="home" class="tab glass">
      <div style="display:flex;align-items:center;gap:10px;margin-bottom:12px;">
        <div style="padding:10px;border-radius:16px;background:linear-gradient(135deg,var(--accent),var(--primary)); color:#fff;">üì±</div>
        <div>
          <h2 style="margin:0">Telefon Ustaxona</h2>
          <p class="muted" style="margin-top:2px">Professional servis. Aniq diagnoz. Tez yordam.</p>
        </div>
      </div>
      <p>Qurilmangizni tanlang va muammoni yozing ‚Äî AI batafsil tahlil va bosqichma‚Äëbosqich tavsiya beradi.</p>
      <div class="grid-2" style="margin-top:12px;">
        <button class="btn primary" onclick="goTab('brand')">Brend/Model</button>
        <button class="btn" onclick="goTab('ai')">AI tahlil</button>
      </div>
      <div class="glass" style="margin-top:12px; display:flex; align-items:center; justify-content:space-between; gap:8px;">
        <div>
          <div style="font-weight:600">üì£ Teleshop kanali</div>
          <div class="muted" style="font-size:12px">Yangiliklar, aksiyalar va maslahatlar</div>
        </div>
        <a class="btn primary" href="https://t.me/teleshopuz" target="_blank" rel="noopener">Obuna bo‚Äòlish</a>
      </div>
    </section>

    <div class="glass" style="margin-top:12px">
    <div class="grid-3">
        <button class="btn" onclick="goTab('brand')">üè∑Ô∏è Brend</button>
        <button class="btn" onclick="goTab('ai')">ü§ñ AI</button>
        <a class="btn" href="https://t.me/teleshopuz" target="_blank">üì£ Teleshop</a>
    </div>
    </div>



    <section id="historyCard" class="glass hidden">
      <div style="display:flex;align-items:center;justify-content:space-between;gap:8px;">
        <div>
          <h3>AI so'rovlar tarixi</h3>
          <p class="muted">Oxirgi 10 ta</p>
        </div>
        <button class="btn" onclick="clearHistory()">üßπ Tozalash</button>
      </div>
      <div id="historyList" style="display:grid;gap:8px;margin-top:8px;"></div>
    </section>

    <!-- BRAND/MODEL TAB -->
    <section data-tab="brand" class="tab glass hidden">
        <h3>Qurilmangizni tanlang</h3>
        <p class="muted">Brend va modelni belgilang.</p>

        <div class="row" style="margin-top:8px;">
            <div>
            <label for="brand">Brend</label>
            <select id="brand" class="select"></select>
            </div>

            <div>
            <label for="model">Model</label>
            <select id="model" class="select" disabled></select>
            </div>

            <div class="grid-2">
            <button class="btn primary" onclick="goTab('ai')">AIga o'tish ‚Üí</button>
            <button class="btn" onclick="resetBrandModel()">Tozalash</button>
            </div>
        </div>
    </section>

    <!-- AI TAB -->
    <section data-tab="ai" class="tab glass hidden">
      <h3>AI Diagnoz</h3>
      <p class="muted">Muammoni yozing. AI batafsil <b>(sabablar ‚Üí tekshiruv ‚Üí yechim ‚Üí profilaktika)</b> formati bilan javob beradi.</p>
      <div class="row">
        <div>
          <label>Qisqacha muammo (uz/ru)</label>
          <input id="issue" class="input" placeholder="Masalan: qotib ishlayapti, zaryad olmayapti, ekran sinib qolgan" />
        </div>
        <div id="suggestions" class="chips"></div>
        <div class="grid-2">
          <button id="aiBtn" class="btn primary">AI tahlil</button>
          <button class="btn" onclick="setIssue('')">Tozalash</button>
        </div>
        <div class="glass hidden" id="aiResultWrap" style="margin-top:2px;">
          <h3 style="font-size:16px">ü§ñ AI natijasi</h3>
          <div id="aiResult" style="margin-top:8px"></div>
          <div class="badge" style="margin-top:10px" id="aiHint">Yakuniy diagnoz ustada tasdiqlanadi. Muhim ma'lumotlarni zaxiralashni unutmang.</div>
        </div>
      </div>
    </section>

    <!-- HELP TAB -->
    <section data-tab="help" class="tab glass hidden">
      <h3>Ma'lumot</h3>
      <p class="muted">Buyurtma sahifasi yo‚Äòq ‚Äî faqat AI va brend/model tanlash. Teleshop kanali reklama tugmasi qo‚Äòshildi.</p>
      <div class="row" style="margin-top:8px;">
        <div class="badge">Liquid glass UI</div>
        <div class="badge">Kuchli blur</div>
        <div class="badge">Pro rang palitrasi</div>
        <div class="badge">AI batafsil javob</div>
      </div>
      <div class="glass" style="margin-top:10px;display:flex;align-items:center;justify-content:space-between;gap:8px;">
        <div>
          <div style="font-weight:600">üì£ Teleshop kanali</div>
          <p class="muted" style="margin-top:4px">Yangiliklar, aksiyalar, chegirmalar</p>
        </div>
        <a class="btn primary" href="https://t.me/teleshopuz" target="_blank" rel="noopener">Obuna bo‚Äòling</a>
      </div>
    </section>
  </div>

  <!-- Footer nav -->
  <div class="footer">
    <div class="footer-inner">
      <div class="nav">
        <button data-nav="home" class="btn active" onclick="goTab('home')">üè†<span>Asosiy</span></button>
        <button data-nav="brand" class="btn" onclick="goTab('brand')">üè∑Ô∏è<span>Brend</span></button>
        <button data-nav="ai" class="btn" onclick="goTab('ai')">ü§ñ<span>AI</span></button>
        <button data-nav="help" class="btn" onclick="goTab('help')">‚ÑπÔ∏è<span>Yordam</span></button>
      </div>
    </div>
  </div>

  <script>
    // ‚Äî‚Äî‚Äî Telegram WebApp integration ‚Äî‚Äî‚Äî
    const tg = window?.Telegram?.WebApp || null;
    try { tg?.ready(); tg?.expand(); } catch(e){}

    // ‚Äî‚Äî‚Äî Theme toggle ‚Äî‚Äî‚Äî
    const themeBtn = document.getElementById('themeBtn');
    const prefers = localStorage.getItem('ux_theme') || (tg?.themeParams?.bg_color ? 'dark' : 'light');
    if(prefers==='light') document.documentElement.classList.add('light');
    themeBtn?.addEventListener('click', ()=>{
      document.documentElement.classList.toggle('light');
      const isLight = document.documentElement.classList.contains('light');
      localStorage.setItem('ux_theme', isLight ? 'light' : 'dark');
    });

    // ‚Äî‚Äî‚Äî State ‚Äî‚Äî‚Äî
    const state = { brand:'', model:'', issue:'', history: JSON.parse(localStorage.getItem('tx_history')||'[]') };

    // ‚Äî‚Äî‚Äî Data ‚Äî‚Äî‚Äî
    const BRANDS = {
    Apple: [
        // ‚úÖ iPhone 15 seriyasi
        "iPhone 15 Pro Max", "iPhone 15 Pro", "iPhone 15 Plus", "iPhone 15",
        // ‚úÖ iPhone 14 seriyasi
        "iPhone 14 Pro Max", "iPhone 14 Pro", "iPhone 14 Plus", "iPhone 14",
        // ‚úÖ iPhone 13 seriyasi
        "iPhone 13 Pro Max", "iPhone 13 Pro", "iPhone 13", "iPhone 13 mini",
        // ‚úÖ iPhone 12 seriyasi
        "iPhone 12 Pro Max", "iPhone 12 Pro", "iPhone 12", "iPhone 12 mini",
        // ‚úÖ iPhone 11 seriyasi
        "iPhone 11 Pro Max", "iPhone 11 Pro", "iPhone 11",
        // ‚úÖ Oldingi Pro/X seriyalari
        "iPhone XS Max", "iPhone XS", "iPhone XR", "iPhone X",
        // ‚úÖ Oldingi seriyalar va SE
        "iPhone 8 Plus", "iPhone 8", "iPhone 7 Plus", "iPhone 7", "iPhone SE (3rd Gen)", "iPhone SE (2nd Gen)", "iPhone 6s Plus", "iPhone 6s"
    ],

    Samsung: [
        // ‚úÖ Galaxy S (Flagman)
        "Galaxy S24 Ultra", "Galaxy S24+", "Galaxy S24",
        "Galaxy S23 Ultra", "Galaxy S23+", "Galaxy S23", "Galaxy S23 FE",
        "Galaxy S22 Ultra", "Galaxy S22+", "Galaxy S22",
        "Galaxy S21 Ultra", "Galaxy S21+", "Galaxy S21", "Galaxy S21 FE",
        // ‚úÖ Galaxy Z (Buklanadigan)
        "Galaxy Z Fold5", "Galaxy Z Flip5", "Galaxy Z Fold4", "Galaxy Z Flip4", "Galaxy Z Fold3", "Galaxy Z Flip3",
        // ‚úÖ Galaxy A (O'rta toifa)
        "Galaxy A74", "Galaxy A55", "Galaxy A54", "Galaxy A53", "Galaxy A52s 5G",
        "Galaxy A35", "Galaxy A34", "Galaxy A33", "Galaxy A25", "Galaxy A24",
        "Galaxy A15", "Galaxy A14", "Galaxy A05s", "Galaxy A04s",
        // ‚úÖ Galaxy M (Onlayn bozor)
        "Galaxy M54", "Galaxy M53", "Galaxy M34", "Galaxy M33", "Galaxy M14", "Galaxy M13",
        // ‚úÖ Note seriyasi
        "Galaxy Note 20 Ultra", "Galaxy Note 20", "Galaxy Note 10+", "Galaxy Note 10"
    ],

    Xiaomi: [
        // ‚úÖ Xiaomi Flagman (Mi Seriya)
        "Xiaomi 14 Ultra", "Xiaomi 14 Pro", "Xiaomi 14", "Xiaomi 13 Ultra", "Xiaomi 13 Pro", "Xiaomi 13",
        "Xiaomi 12S Ultra", "Xiaomi 12 Pro", "Xiaomi 12", "Xiaomi 11 Ultra", "Xiaomi 11 Pro",
        // ‚úÖ Redmi Note (O'rta toifa)
        "Redmi Note 13 Pro+", "Redmi Note 13 Pro", "Redmi Note 13",
        "Redmi Note 12 Pro+", "Redmi Note 12 Pro", "Redmi Note 12", "Redmi Note 11 Pro+", "Redmi Note 11 Pro", "Redmi Note 11",
        // ‚úÖ Redmi (Boshlang'ich)
        "Redmi 13C", "Redmi 12", "Redmi 10",
        // ‚úÖ POCO (Ishlashga yo'naltirilgan)
        "Poco F5 Pro", "Poco F5", "Poco X6 Pro", "Poco X6", "Poco M6 Pro", "Poco M5s", "Poco C65"
    ],

    Huawei: [
        // ‚úÖ P Seriyasi (Flagman)
        "P60 Pro", "P50 Pro", "P40 Pro+", "P40 Pro", "P30 Pro",
        // ‚úÖ Mate Seriyasi (Flagman)
        "Mate 60 Pro", "Mate 50 Pro", "Mate 40 Pro",
        // ‚úÖ Nova Seriyasi (O'rta/Premium)
        "Nova 12 SE", "Nova 11 Pro", "Nova 11", "Nova 10 Pro", "Nova 10", "Nova 9"
    ],

    Oppo: [
        // ‚úÖ Find X Seriyasi (Flagman)
        "Find X7 Ultra", "Find X7", "Find X6 Pro", "Find X5 Pro",
        // ‚úÖ Reno Seriyasi (Premium O'rta toifa)
        "Reno 11 Pro", "Reno 11", "Reno 10 Pro+", "Reno 10", "Reno 8 Pro",
        // ‚úÖ A Seriyasi (O'rta/Boshlang'ich)
        "A98", "A79", "A78", "A58", "A38"
    ],

    Vivo: [
        // ‚úÖ X Seriyasi (Flagman)
        "X100 Pro", "X100", "X90 Pro", "X90", "X80 Pro",
        // ‚úÖ V Seriyasi (O'rta/Premium)
        "V30 Pro", "V29 Pro", "V29", "V27 Pro", "V27",
        // ‚úÖ Y Seriyasi (O'rta/Boshlang'ich)
        "Y36", "Y35", "Y200", "Y100"
    ],

    Realme: [
        // ‚úÖ GT Seriyasi (Flagman)
        "GT5 Pro", "GT Neo 5", "GT 3", "GT 2 Pro",
        // ‚úÖ Raqamli Seriya (Premium O'rta toifa)
        "12 Pro+", "12 Pro", "11 Pro+", "11 Pro", "10 Pro+", "9 Pro+",
        // ‚úÖ C Seriyasi (Boshlang'ich)
        "C67", "C55", "C53", "C33"
    ],

    Nokia: [
        // ‚úÖ X Seriyasi
        "Nokia X30 5G", "Nokia X21 5G",
        // ‚úÖ G Seriyasi
        "Nokia G60 5G", "Nokia G42 5G", "Nokia G21",
        // ‚úÖ C Seriyasi
        "Nokia C32", "Nokia C22", "Nokia C21 Plus"
    ],
    
    // ‚úÖ Qo'shimcha Mashhur Brendlar
    "Google Pixel": [
        "Pixel 8 Pro", "Pixel 8", "Pixel 7 Pro", "Pixel 7", "Pixel 7a", "Pixel Fold", "Pixel 6 Pro", "Pixel 6"
    ],
    
    "OnePlus": [
        "OnePlus 12", "OnePlus 11", "OnePlus Open", "OnePlus Nord 3", "OnePlus Nord CE 3"
    ]
    };

    const ISSUE_KB = [
      { tag:'Ekran', hints:["Ekran sinib qolgan","Sensor ishlamayapti","Chiziqlar paydo bo'lgan","Nur so'nishi"] },
      { tag:'Batareya', hints:["Tez zaryad tugaydi","Zaryad olmyapti","Qizib ketadi","% sakrab ketadi"] },
      { tag:'Suv', hints:["Suv tushib ketdi","Mikrofon past","Dinamik jim"] },
      { tag:'Kamera', hints:["Orqa kamera xira","Old kamera ochilmaydi","Qora ekran"] },
      { tag:'Tarmoq', hints:["SIM ko'rmayapti","Wi‚ÄëFi uzilib qoladi","IMEI yo'q"] },
      { tag:'Ishlash', hints:["Qotib ishlayapti","Sekinlashib ketdi","O'zi o'chib qoladi","Restart bo'ladi"] },
    ];

    // ‚Äî‚Äî‚Äî Expanded AI rules ‚Äî‚Äî‚Äî
    const AI_RULES = [
      { key:'display', pattern: /(ekran|sensor|display|sin|chiziq)/i, title:"Ekran/Touch", causes:["Sensor shikasti","OLED/LCD nosozligi","Shleyf/konnektor bo'shashi","Yiqilishdan keyingi ichki zarba"], actions:["Modul tekshiruvi","Sensor/OLED test","Shleyfni qayta ulash","Modul/almashtirish"], eta:"1‚Äì2 soat", price:"indikativ" },
      { key:'battery', pattern: /(batareya|zaryad|quvvat|%|tez tugaydi|port)/i, title:"Batareya/Zaryad", causes:["Batareya eskirgan","Zaryad porti changlangan","Adapter/kabel muammosi","Background ilovalar ko'pligi"], actions:["Battery health test","Portni tozalash","Original adapter bilan tekshirish","Batareyani almashtirish"], eta:"30‚Äì60 daqiqa", price:"indikativ" },
      { key:'water', pattern: /(suv|namlik|ho'l|nam)/i, title:"Namlik", causes:["Korroziya","Qisqa tutashuv","Dinamik/Mikrofon namlanishi"], actions:["To'liq tozalash va quritish","Kontaktlarni reanimatsiya","Zararlangan modulni almashtirish"], eta:"2‚Äì4 soat", price:"indikativ" },
      { key:'camera', pattern: /(kamera|selfi|orqa|video)/i, title:"Kamera", causes:["Modul shikasti","Shisha qopqoq chizilgan","Dasturiy xato"], actions:["Modul test","Shisha/Modul almashtirish","Kamera ilovasi ma'lumotlarini tozalash"], eta:"1‚Äì2 soat", price:"indikativ" },
      { key:'network', pattern: /(tarmoq|sim|imei|wifi|wi-?fi|signal)/i, title:"Tarmoq", causes:["Antenna uzuqligi","Baseband nosozligi","Operator muammosi"], actions:["Baseband testi","Antenna ulash/IC ishlari","APN/Sozlamalarni tiklash"], eta:"2‚Äì6 soat", price:"indikativ" },
      { key:'lag', pattern: /(qotib|qotadi|qotib ishlayapti|sekin|lag|o'chib|ochmayapti|restart|hanging|freeze)/i, title:"Ishlash/Sezilarli sekinlashuv", causes:["Xotira to'lib ketgan","Kesh va vaqtinchalik fayllar","Ilova konfliktlari","Qizish/termal throttling","Dasturiy (OS) buzilish"], actions:["Xotirani bo'shatish (10‚Äì20%)","Keshni tozalash","So'nggi o'rnatilgan ilovalarni olib tashlash","Tizimni yangilash yoki qayta yozish","Sovutish tizimini tekshirish"], eta:"30‚Äì90 daqiqa", price:"indikativ" },
    ];

    // ‚Äî‚Äî‚Äî Elements ‚Äî‚Äî‚Äî
    const brandEl = document.getElementById('brand');
    const modelEl = document.getElementById('model');
    const issueEl = document.getElementById('issue');
    const suggWrap = document.getElementById('suggestions');
    const aiBtn = document.getElementById('aiBtn');
    const aiWrap = document.getElementById('aiResultWrap');
    const aiRes = document.getElementById('aiResult');
    const histCard = document.getElementById('historyCard');
    const histList = document.getElementById('historyList');

    // ‚Äî‚Äî‚Äî Init brand list ‚Äî‚Äî‚Äî
function initBrands(){
    let opts = `<option value="">Brendni tanlang</option>`;
    Object.keys(BRANDS).forEach(b=>{
        opts += `<option value="${b}" ${state.brand===b?'selected':''}>${b}</option>`;
    });
    brandEl.innerHTML = opts;
    brandEl.disabled = false;
}



function updateModels(){
    const arr = BRANDS[state.brand] || [];
    if(!arr.length){
        modelEl.innerHTML = `<option value="">Avval brendni tanlang</option>`;
        modelEl.disabled = true;
        return;
    }
    let opts = `<option value="">Modelni tanlang</option>`;
    arr.forEach(m=>{
        opts += `<option value="${m}" ${state.model===m?'selected':''}>${m}</option>`;
    });
    modelEl.innerHTML = opts;
    modelEl.disabled = false;
}



    brandEl.addEventListener('change', e=>{
    state.brand = e.target.value;
    state.model = '';
    updateModels();
    });
    modelEl.addEventListener('change', e=>{
    state.model = e.target.value;
    });

    // ‚Äî‚Äî‚Äî Suggestions as you type ‚Äî‚Äî‚Äî
    function renderSuggestions(){
      const q = (state.issue||'').toLowerCase();
      const items = [];
      ISSUE_KB.forEach(b=> b.hints.forEach(h=>{ if(h.toLowerCase().includes(q) && !items.includes(h)) items.push(h); }));
      suggWrap.innerHTML = items.slice(0,8).map(s=>`<span class="chip" onclick="setIssue('${s.replace(/'/g,"&#39;")}')">${s}<\/span>`).join('');
    }
    function setIssue(v){ state.issue = v; issueEl.value = v; renderSuggestions(); aiWrap.classList.add('hidden'); }
    window.setIssue = setIssue;
    issueEl.addEventListener('input', e=>{ setIssue(e.target.value); });

// ‚Äî‚Äî‚Äî Detailed AI renderer ‚Äî‚Äî‚Äî
function renderAIBlock(rule, ctx){
  const { title, causes, actions, eta, price } = rule;
  const header = `<div class="badge">Bo'lim: ${title}</div>`;
  const summary = `<div class="glass"><h3 style="font-size:14px;margin-bottom:4px">Qisqa xulosa</h3><p>So'rovingiz: <b>${escapeHTML(ctx.query)}</b>. ${title} bo'yicha ehtimoliy nosozliklar topildi. Pastda bosqichma‚Äëbosqich yo'riqnoma berildi.</p></div>`;
  const causeList = `<div class="glass"><h3 style="font-size:14px;margin-bottom:4px">Ehtimoliy sabablar</h3><ul style="margin:0;padding-left:18px;color:var(--text);">${causes.map(c=>`<li>${c}<\/li>`).join('')}</ul></div>`;
  const diag = `<div class="glass"><h3 style="font-size:14px;margin-bottom:4px">Uy sharoitida tekshiruv</h3><ol style="margin:0;padding-left:18px;color:var(--text);">${composeHomeChecks(rule.key).map(x=>`<li>${x}<\/li>`).join('')}</ol></div>`;
  const fix = `<div class="glass"><h3 style="font-size:14px;margin-bottom:4px">Tavsiya etilgan yechim</h3><ul style="margin:0;padding-left:18px;color:var(--text);">${actions.map(a=>`<li>${a}<\/li>`).join('')}</ul></div>`;
  const meta = `<div class="grid-2"><div class="badge">Vaqt: ${eta}</div><div class="badge">Narx: ${price}</div></div>`;
  const safety = `<div class="glass"><h3 style=\"font-size:14px;margin-bottom:4px\">Ma'lumot xavfsizligi</h3><ul style=\"margin:0;padding-left:18px;color:var(--text);\"><li>Zaxira nusxa yarating (Google/ iCloud/Kompyuter).</li><li>Namlik/ekran muammosida qurilmani ishlatishni cheklang va o'chiring.</li><li>Har doim rasmiy zaryadlovchi va sifatli kabeldan foydalaning.</li></ul></div>`;
  const promo = `<div class="glass" style="display:flex;align-items:center;justify-content:space-between;gap:8px;"><div><div style="font-weight:600">üì£ Teleshop</div><p class="muted" style="margin-top:4px">Yangiliklar va aksiyalar</p></div><a class="btn primary" href="https://t.me/teleshopuz" target="_blank" rel="noopener">Obuna bo‚Äòling</a></div>`;
  return [header, summary, causeList, diag, fix, meta, safety, promo].join('');
}

function composeHomeChecks(key){
  switch(key){
    case 'display':
      return [
        "Qattiq himoya oynasini (zaschitniy steklo) olib sinab ko'ring",
        "Screenshotda chiziq/nuqta ko'rinadimi tekshiring (ko'rinsa ‚Äî dasturiy, ko'rinmasa ‚Äî apparat buzilishi)",
        "Sensor test ilovasi orqali multi‚Äëtouch va o'lik nuqtalarni tekshiruvi",
        "Ekranni avtomatik yorqinligini o'chirib, statik yorqinlikda sinab ko'ring"
      ];
    case 'battery':
      return [
        "Boshqa original adapter/kabel bilan sinab ko'ring",
        "Zaryad portini ehtiyotkorlik bilan tozalang (yog'och tish cho'p yordamida)",
        "Batareya sog'ligini tekshiring (Android: *AccuBattery*, iOS: *Settings ‚Üí Battery ‚Üí Health*)",
        "Keraksiz ilovalarni va fon jarayonlarini o'chirish orqali quvvat sarfini kuzating"
      ];
    case 'water':
      return [
        "Qurilmani **darhol** o'chiring va uni qayta yoqishga urinmang",
        "Zaryadga **mutlaqo** qo'ymang",
        "SIM tray va portlarni fen yordamida quritishga urinmang (issiq havo ichki qismlarni buzadi)",
        "Servisga tezda murojaat qiling ‚Äî korroziya vaqt o'tishi bilan kuchayadi va tiklab bo'lmas holga keltiradi"
      ];
    case 'camera':
      return [
        "Kamerani boshqa ilovada (masalan, Telegram kamerasida) sinab ko'ring",
        "Kamera ilovasi ma'lumotlari va keshini tozalang (Sozlamalar ‚Üí Ilovalar)",
        "Linza/qopqoqni mikrofibra mato bilan tozalang",
        "Old kamera ishlayotganini, lekin asosiy kamera ishlamayotganini tekshiring (aks holda apparat muammo ehtimoli yuqori)"
      ];
    case 'network':
      return [
        "Aviorejimni 30 soniyaga yoqib o'chiring",
        "APN (Access Point Names) sozlamalarini standartga qaytaring (Sozlamalar ‚Üí Mobil tarmoq ‚Üí APN)",
        "SIM kartani boshqa telefonda sinab ko'ring yoki boshqa SIM kartani o'zingizda sinab ko'ring",
        "Tarmoq sozlamalarini qayta tiklash (Wi-Fi, mobil ma'lumotlar, Bluetooth)"
      ];
    case 'lag':
      return [
        "So'nggi o'rnatilgan ilovalarni vaqtincha o'chiring (ular xotirani to'ldirishi yoki konflikt berishi mumkin)",
        "Bo'sh joyni 10‚Äì20% gacha oching (kamida 5GB bo'sh joy qoldiring)",
        "Tizim yangilanishini o'rnating (ko'pincha optimalizatsiyalar kiritilgan bo'ladi)",
        "Qizish bo'lsa, og'ir vazifalarni cheklab, himoya qopqoqsiz ishlatib ko'ring"
      ];
    case 'audio':
      return [
        "Quloqchinlarni ulab yoki uzib sinab ko'ring (audio karnay/port muammosini ajratish uchun)",
        "Ovoz karnay (dinamik) va mikrofon teshiklarini ehtiyotkorlik bilan tozalang (chang to'planishi mumkin)",
        "Maxfiy kodlar orqali diagnostika rejimida mikrofon va karnayni tekshiring (*#0*# Samsungda)"
      ];
    case 'buttons':
      return [
        "Himoya g'ilofi (chexol) sabab bo'layotganini tekshirish uchun uni olib sinab ko'ring",
        "Tugmalar atrofidagi chang va kirni tekshiring",
        "Qurilmani xavfsiz rejimda (Safe Mode) yuklab, tugmalar ishini tekshiring (Dasturiy konfliktni aniqlash uchun)"
      ];
    case 'software':
      return [
        "Kerakli barcha ma'lumotlaringizni zaxira nusxasini yarating (bu eng muhim qadam!)",
        "Telefonni to'liq o'chirib, qayta yoqing (reboot)",
        "Telefonni zavod sozlamalariga qaytarishga urinib ko'ring (oxirgi chora)"
      ];
    case 'storage':
      return [
        "Ilovalarning kesh xotirasini muntazam tozalang (Telegram, Browser, TikTok kabi)",
        "Keraksiz katta fayllar (videolar, yuklamalar) va foto/videolarning bulutli zaxira nusxalarini tekshiring",
        "SD-kartadan foydalansangiz, uni olib telefonda bo'sh joy qandayligini tekshiring (SD-kartada xato bo'lishi mumkin)"
      ];
    default:
      return [
        "Umumiy tekshiruv: telefonni qayta ishga tushiring (restart)",
        "Tizim yangilanishlarini tekshiring va o'rnating",
        "So'nggi o'rnatilgan ilovalarni tekshiring va keraksizlarini o'chiring",
        "Zaxira nusxa yaratib, zavod sozlamalariga qaytarishni ko'rib chiqing (oxirgi chora)"
      ];
  }
}

    function escapeHTML(str){ return (str||'').replace(/[&<>"']/g, s=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[s])); }

    aiBtn.addEventListener('click', async ()=>{
      const text = [state.issue, state.model, state.brand].join(' ').trim();
      if(!text){ alert("Muammoni yozing"); return; }

      // Local rule match
      const rule = AI_RULES.find(r=> r.pattern.test(text));

      // Optional GPT backend (if you wire /ai)
      // const gpt = await callGPT(text).catch(()=>null);

      const blocks = [];
      if(rule) blocks.push(renderAIBlock(rule, { query: text }));

      // If GPT supplied, append below (uncomment when backend ready)
      // if(gpt && gpt.detail){
      //   blocks.push(`<div class="glass"><h3 style="font-size:14px">GPT qo'shimcha tafsiloti</h3><p>${escapeHTML(gpt.detail)}</p></div>`);
      // }

      // If no rule hit, give a generic but detailed template
      if(!blocks.length){
        blocks.push(`<div class=\"glass\"><h3 style=\"font-size:14px\">Umumiy yo'riqnoma</h3><p>So'rov: <b>${escapeHTML(text)}</b>. Muammo aniq emas. Iltimos, simptomlarni batafsil yozing: qachondan boshlangan, qaysi ilovada, xato xabarlari, suv/zarba bo'lgan‚Äëbo'lmagan.</p></div>`);
      }

      // Special quick help for lag/freeze even if another category matched too
      if(/qotib|lag|sekin|restart|o'chib|freeze|hanging/i.test(text)){
        blocks.push(`<div class=\"glass\"><h3 style=\"font-size:14px\">Tez yordam: qotib ishlash</h3><ol style=\"margin:0;padding-left:18px\"><li>Fon ilovalarni yopish va keshni tozalash</li><li>Ilova ruxsatlarini tartibga keltirish (Background limits)</li><li>"Safe mode"da ishga tushirib sinash</li><li>Muammo davom etsa: dasturiy qayta yozish tavsiya etiladi</li></ol></div>`);
      }

      aiRes.innerHTML = blocks.join('');
      aiWrap.classList.remove('hidden');

      pushHistory({ brand: state.brand, model: state.model, issue: state.issue });
    });

    async function callGPT(query){
      // Backendda /ai endpointingiz OpenAI bilan muloqot qiladi.
      // return fetch('/ai', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ q: query, brand: state.brand, model: state.model }) }).then(r=>r.json());
      return null;
    }

    // ‚Äî‚Äî‚Äî History ‚Äî‚Äî‚Äî
    function pushHistory(item){
      const rec = { ...item, ts: Date.now() };
      const arr = [rec, ...state.history].slice(0,10);
      state.history = arr; localStorage.setItem('tx_history', JSON.stringify(arr));
      renderHistory();
    }
    function clearHistory(){
      state.history = []; localStorage.removeItem('tx_history'); renderHistory();
    }
    window.clearHistory = clearHistory;

    function resetBrandModel(){
        state.brand = '';
        state.model = '';
        initBrands();
        updateModels();
    }
    window.resetBrandModel = resetBrandModel;


    function renderHistory(){
      if(!state.history.length){ histCard.classList.add('hidden'); return; }
      histCard.classList.remove('hidden');
      histList.innerHTML = state.history.map(h=>{
        const t = new Date(h.ts).toLocaleTimeString();
        const bm = `${h.brand||'‚Äî'} ${h.model||''}`.trim();
        const iss = h.issue||'‚Äî';
        return `<div class="glass" style="padding:10px;display:flex;align-items:center;justify-content:space-between;gap:8px;">\
          <div style="min-width:0">\
            <div style="font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">${bm||'Model kiritilmagan'}<\/div>\
            <div class="muted" style="white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">${iss}<\/div>\
          <\/div>\
          <span class="badge">${t}<\/span>\
        <\/div>`
      }).join('');
    }

    // ‚Äî‚Äî‚Äî Tabs ‚Äî‚Äî‚Äî
    function goTab(key){
      document.querySelectorAll('.tab').forEach(el=> el.classList.add('hidden'));
      document.querySelector(`section[data-tab="${key}"]`)?.classList.remove('hidden');
      document.querySelectorAll('.nav .btn').forEach(b=> b.classList.remove('active'));
      document.querySelectorAll('.nav [data-nav]').forEach(b=> b.classList.remove('active'));
      document.querySelector(`.nav [data-nav="${key}"]`)?.classList.add('active');

      if(key==='home') renderHistory();
      window.scrollTo({top:0, behavior:'smooth'});
    }
    window.goTab = goTab;
    function sendQuick(type){ try{ tg?.sendData?.(JSON.stringify({action:type, ts:Date.now()})); }catch(e){} }

    // ‚Äî‚Äî‚Äî Boot ‚Äî‚Äî‚Äî
    function renderSuggestionsBoot(){
      const base = ["Qotib ishlayapti","Zaryad olmayapti","Ekran sinib qolgan","SIM ko'rmayapti","Wi‚ÄëFi uzilib qoladi","Kamera xira"];
      suggWrap.innerHTML = base.map(s=>`<span class=\"chip\" onclick=\"setIssue('${s}')\">${s}<\/span>`).join('');
    }
(function boot(){
    initBrands();
    updateModels();
    renderHistory();
    renderSuggestionsBoot();
})();

  </script>
</body>
</html>
